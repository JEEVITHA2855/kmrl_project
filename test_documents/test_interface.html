<!DOCTYPE html>
<html>
<head>
    <title>Document Processing System</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { max-width: 800px; margin: 0 auto; }
        .result { margin-top: 20px; white-space: pre-wrap; }
        .alert { 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 4px;
            border-left: 5px solid;
        }
        .critical { 
            background-color: #ffebee; 
            border-left-color: #d32f2f;
        }
        .high { 
            background-color: #fff3e0; 
            border-left-color: #f57c00;
        }
        .medium { 
            background-color: #e8f5e9; 
            border-left-color: #388e3c;
        }
        .low { 
            background-color: #e3f2fd; 
            border-left-color: #1976d2;
        }
        .accuracy-info {
            background-color: #f5f5f5;
            border-left-color: #2196f3;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Document Processing System</h1>
        <div style="margin-bottom: 20px;">
            <form id="uploadForm" style="display: inline-block; margin-right: 10px;">
                <input type="file" id="file" accept=".txt,.doc,.docx,.pdf" required>
                <button type="submit">Upload and Process</button>
            </form>
            <button onclick="runAccuracyTest()" style="padding: 5px 10px;">Run Accuracy Test</button>
            <button onclick="window.location.href='document_history.html'" style="padding: 5px 10px;">View Document History</button>
        </div>
        <div id="result" class="result"></div>
    </div>

    <script>
        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData();
            const fileInput = document.getElementById('file');
            formData.append('file', fileInput.files[0]);

            try {
                const response = await fetch('http://127.0.0.1:8000/upload/', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                displayResult(result);
            } catch (error) {
                document.getElementById('result').innerHTML = `Error: ${error.message}`;
            }
        });

        function displayResult(result) {
            let html = '<h2>Processing Results:</h2>';
            
            // Display accuracy metrics if available
            if (result.metrics) {
                html += '<h3>Accuracy Metrics:</h3>';
                html += `<div class="alert high">
                    <strong>Overall Accuracy:</strong> ${(result.overall_accuracy * 100).toFixed(2)}%<br>
                    <strong>Department Accuracy:</strong> ${(result.metrics.department_accuracy * 100).toFixed(2)}%<br>
                    <strong>Severity Accuracy:</strong> ${(result.metrics.severity_accuracy * 100).toFixed(2)}%<br>
                    <strong>Keyword Accuracy:</strong> ${(result.metrics.keyword_accuracy * 100).toFixed(2)}%
                </div>`;
            }
            
            // Display alerts
            if (result.alerts && result.alerts.length > 0) {
                html += '<h3>Alerts Detected:</h3>';
                result.alerts.forEach(alert => {
                    html += `<div class="alert ${alert.severity}">
                        <strong>Department:</strong> ${alert.department}<br>
                        <strong>Severity:</strong> ${alert.severity}<br>
                        <strong>Keywords:</strong> ${alert.keywords.join(', ')}
                    </div>`;
                });
            }

            // Display departments
            if (result.departments && result.departments.length > 0) {
                html += '<h3>Notified Departments:</h3>';
                result.departments.forEach(dept => {
                    html += `<div class="alert ${dept.severity}">
                        <strong>${dept.name}</strong><br>
                        Severity: ${dept.severity}
                    </div>`;
                });
            }

            // Display content preview
            if (result.content_preview) {
                html += '<h3>Content Preview:</h3>';
                html += `<pre>${result.content_preview}</pre>`;
            }

            document.getElementById('result').innerHTML = html;
        }

        async function runAccuracyTest() {
            try {
                const response = await fetch('http://127.0.0.1:8000/test-accuracy', {
                    method: 'GET'
                });

                const result = await response.json();
                displayAccuracyResult(result);
            } catch (error) {
                document.getElementById('result').innerHTML = `Error running accuracy test: ${error.message}`;
            }
        }

        function displayAccuracyResult(result) {
            let html = '<h2>Accuracy Test Results:</h2>';
            html += `<div class="alert high">
                <strong>Overall Accuracy:</strong> ${(result.overall_accuracy * 100).toFixed(2)}%<br>
                <strong>Department Accuracy:</strong> ${(result.metrics.department_accuracy * 100).toFixed(2)}%<br>
                <strong>Severity Accuracy:</strong> ${(result.metrics.severity_accuracy * 100).toFixed(2)}%<br>
                <strong>Keyword Accuracy:</strong> ${(result.metrics.keyword_accuracy * 100).toFixed(2)}%
            </div>`;
            document.getElementById('result').innerHTML = html;
        }
    </script>
</body>
</html>